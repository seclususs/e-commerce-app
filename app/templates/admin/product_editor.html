{% extends "layouts/admin_layout.html" %}

{% block admintitle %}Edit Produk{% endblock %}
{% block adminheader %}Edit Produk: {{ product.name }}{% endblock %}

{% block admincontent %}
<div class="admin-card animated-element">
    <form method="POST" action="{{ url_for('admin.admin_edit_product', id=product.id) }}" enctype="multipart/form-data">
        <div class="form-grid">
            <div class="form-group"><label for="name">Nama Produk</label><input type="text" id="name" name="name" value="{{ product.name }}" required></div>
            <div class="form-group"><label for="price">Harga Asli</label><input type="text" inputmode="numeric" id="price" name="price" value="{{ product.price }}" required></div>
            <div class="form-group"><label for="discount_price">Harga Diskon</label><input type="text" inputmode="numeric" id="discount_price" name="discount_price" value="{{ product.discount_price or '' }}"></div>
            <div class="form-group"><label for="category_id">Kategori</label>
                <select id="category_id" name="category_id" class="form-control" required>
                    {% for cat in categories %}<option value="{{ cat.id }}" {% if cat.id == product.category_id %}selected{% endif %}>{{ cat.name }}</option>{% endfor %}
                </select>
            </div>
            <div class="form-group"><label for="colors">Warna</label><input type="text" id="colors" name="colors" value="{{ product.colors or '' }}" placeholder="cth: Hitam, Putih"></div>
        </div>
        
        <div class="form-group form-group-inline">
            <label class="custom-checkbox">
                <input type="checkbox" name="has_variants" id="has-variants-checkbox" class="checkbox-input" {% if product.has_variants %}checked{% endif %}>
                <span class="checkbox-box"><span class="checkmark"></span></span>
                <span>Produk ini memiliki varian ukuran</span>
            </label>
        </div>

        <div class="form-group" id="stock-input-container" style="display: {{ 'none' if product.has_variants else 'block' }};">
            <label for="stock">Stok (jika tidak ada varian)</label>
            <input type="number" id="stock" name="stock" value="{{ product.stock }}">
        </div>
         <p class="form-hint" style="margin-top: -0.5rem;">Jika produk memiliki varian, stok total akan dihitung otomatis. <a href="{{ url_for('admin.manage_variants', product_id=product.id) }}" style="color: var(--color-primary);">Kelola varian di sini.</a></p>
        
        <div class="form-group">
            <label>Gambar Saat Ini</label>
            <p class="form-hint">Pilih satu gambar sebagai gambar utama. Centang untuk menghapus.</p>
            <div id="existing-image-previews" class="image-preview-container">
                <div class="preview-item {% if product.image_url %}is-main{% endif %}">
                    <img src="{{ url_for('static', filename='uploads/' + product.image_url) }}" alt="{{ product.name }}">
                    <div class="main-image-indicator"><i class="fas fa-star"></i> Utama</div>
                    <input type="radio" name="main_image" value="{{ product.image_url }}" class="main-image-radio" checked>
                    <div class="delete-checkbox-overlay">
                        <label class="custom-checkbox" title="Tandai untuk hapus"><input type="checkbox" name="delete_image" value="{{ product.image_url }}" class="checkbox-input delete-image-checkbox"><span class="checkbox-box"><span class="checkmark"></span></span></label>
                    </div>
                </div>
                {% for image in additional_images %}
                <div class="preview-item">
                    <img src="{{ url_for('static', filename='uploads/' + image) }}" alt="{{ product.name }}">
                    <div class="main-image-indicator"><i class="fas fa-star"></i> Utama</div>
                    <input type="radio" name="main_image" value="{{ image }}" class="main-image-radio">
                     <div class="delete-checkbox-overlay">
                        <label class="custom-checkbox" title="Tandai untuk hapus"><input type="checkbox" name="delete_image" value="{{ image }}" class="checkbox-input delete-image-checkbox"><span class="checkbox-box"><span class="checkmark"></span></span></label>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="form-group">
            <label for="new_images">Tambah Gambar Baru (Opsional)</label>
            <div>
                <label for="new_images" class="custom-file-upload">Pilih Gambar</label>
                <input type="file" id="new_images" name="new_images" accept="image/*" multiple>
                 <span id="new-file-name" class="file-name-display">Belum ada file baru dipilih</span>
            </div>
            <div id="new-image-previews" class="image-preview-container"></div>
        </div>

        <div class="form-group"><label for="description">Deskripsi</label><textarea id="description" name="description" rows="4" required>{{ product.description }}</textarea></div>
        <div class="form-actions">
            <button type="submit" class="cta-button">Simpan Perubahan</button>
            <a href="{{ url_for('admin.admin_products') }}" class="cta-button-secondary">Batal</a>
        </div>
    </form>
</div>
{% endblock %}