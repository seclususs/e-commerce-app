{% extends "layouts/admin_layout.html" %}

{% block admintitle %}Detail Pesanan #{{ order.id }}{% endblock %}
{% block adminheader %}Detail Pesanan #{{ order.id }}{% endblock %}

{% block admincontent %}
<div style="margin-bottom: 2rem;">
    <a href="{{ url_for('admin.admin_orders') }}" class="cta-button-secondary">&larr; Kembali ke Daftar Pesanan</a>
    <!-- Tombol Cetak Invoice -->
    <a href="{{ url_for('admin.admin_order_invoice', id=order.id) }}" target="_blank" class="cta-button" style="float: right;">Cetak Invoice</a>
</div>
<div class="order-detail-grid">
    <div class="admin-card">
        <h3>Informasi Pesanan</h3>
        <p><strong>ID Pesanan:</strong> #{{ order.id }}</p>
        <p><strong>Tanggal:</strong> {{ order.order_date }}</p>
        <p><strong>Pelanggan:</strong> {{ order.customer_name or 'Tamu' }} ({{ order.email or 'N/A' }})</p>
        <p><strong>Total Pembayaran:</strong> {{ order.total_amount|rupiah }}</p>
        <p><strong>Metode Pembayaran:</strong> {{ order.payment_method or 'N/A' }}</p>
        <p><strong>Status Saat Ini:</strong> <span class="status-badge status-{{ order.status|status_class }}">{{ order.status }}</span></p>
    </div>
    <div class="admin-card">
        <h3>Update Pesanan</h3>
        <form action="{{ url_for('admin.update_order_status', id=order.id) }}" method="POST">
             <!-- Update status dan nomor resi dalam satu form -->
            <div class="form-group">
                <label for="status">Ubah Status</label>
                <select name="status" id="status" class="form-control">
                    <option value="Menunggu Pembayaran" {% if order.status == 'Menunggu Pembayaran' %}selected{% endif %}>Menunggu Pembayaran</option>
                    <option value="Diproses" {% if order.status == 'Diproses' %}selected{% endif %}>Diproses</option>
                    <option value="Dikirim" {% if order.status == 'Dikirim' %}selected{% endif %}>Dikirim</option>
                    <option value="Selesai" {% if order.status == 'Selesai' %}selected{% endif %}>Selesai</option>
                    <option value="Dibatalkan" {% if order.status == 'Dibatalkan' %}selected{% endif %}>Dibatalkan</option>
                </select>
            </div>
             <div class="form-group">
                <label for="tracking_number">Nomor Resi Pengiriman</label>
                <input type="text" name="tracking_number" id="tracking_number" class="form-control" value="{{ order.tracking_number or '' }}" placeholder="Masukkan nomor resi di sini">
            </div>
            <button type="submit" class="cta-button form-button">Update Pesanan</button>
        </form>
    </div>
</div>

<div class="admin-card">
    <h3>Informasi Pengiriman</h3>
    <p><strong>Nama Penerima:</strong> {{ order.shipping_name or 'N/A' }}</p>
    <p><strong>Telepon:</strong> {{ order.shipping_phone or 'N/A' }}</p>
    <p><strong>Alamat:</strong><br>
        {{ order.shipping_address_line_1 or '' }}<br>
        {% if order.shipping_address_line_2 %}{{ order.shipping_address_line_2 }}<br>{% endif %}
        {{ order.shipping_city or '' }}, {{ order.shipping_province or '' }} {{ order.shipping_postal_code or '' }}
    </p>
</div>

<div class="admin-card">
    <h3>Item yang Dipesan</h3>
    <div class="table-wrapper">
        <table class="admin-table">
            <thead><tr><th>Nama Produk</th><th>Jumlah</th><th>Harga Satuan</th><th>Subtotal</th></tr></thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.name }}</td><td>{{ item.quantity }}</td><td>{{ item.price|rupiah }}</td><td>{{ (item.price * item.quantity)|rupiah }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}