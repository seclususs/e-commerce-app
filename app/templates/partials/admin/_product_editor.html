<div class="admin-tabs-container" id="product-editor-container">
    <div style="margin-bottom: 1rem;" class="animated-element">
        <a href="{{ url_for('admin.admin_products') }}" class="cta-button-secondary" data-no-transition>&larr; Kembali ke Daftar Produk</a>
    </div>

    <div class="admin-tabs">
        <button type="button" class="admin-tab-btn active" data-tab="tab-info">Informasi Umum</button>
        <button type="button" class="admin-tab-btn" data-tab="tab-variants" id="tab-btn-variants" style="display: {{ 'flex' if product.has_variants else 'none' }};">
            Varian Produk
        </button>
    </div>

    <div class="admin-tab-content active" id="tab-info">
        <div class="admin-card animated-element">
            <form method="POST" action="{{ url_for('admin.admin_edit_product', id=product.id) }}" enctype="multipart/form-data" data-ajax="true" data-update-action="redirect">
                <div class="form-grid">
                    <div class="form-group"><label for="name">Nama Produk</label><input type="text" id="name" name="name" value="{{ product.name }}" required></div>
                    <div class="form-group"><label for="price">Harga Asli</label><input type="text" inputmode="numeric" id="price" name="price" value="{{ product.price|int }}" required></div>
                    <div class="form-group"><label for="discount_price">Harga Diskon</label><input type="text" inputmode="numeric" id="discount_price" name="discount_price" value="{{ product.discount_price|int if product.discount_price else '' }}"></div>
                    <div class="form-group"><label for="category_id">Kategori</label>
                        <select id="category_id" name="category_id" class="form-control" required>
                            {% for cat in categories %}<option value="{{ cat.id }}" {% if cat.id == product.category_id %}selected{% endif %}>{{ cat.name }}</option>{% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="colors">Teks Deskripsi Warna</label>
                        <input type="text" id="colors" name="colors" value="{{ product.colors or '' }}" placeholder="cth: Hitam, Putih, Biru">
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="custom-checkbox">
                        <input type="checkbox" name="has_variants" id="has-variants-checkbox" class="checkbox-input"
                               data-initial-state="{{ 'true' if product.has_variants else 'false' }}"
                               {% if product.has_variants %}checked{% endif %}
                               {% if product.variants and product.variants|length > 1 %}disabled title="Hapus semua varian kecuali satu untuk mengubah tipe produk."{% endif %}>
                        <span class="checkbox-box"><span class="checkmark"></span></span>
                        <span>Produk ini memiliki varian (Warna/Ukuran)</span>
                    </label>
                    {% if product.variants and product.variants|length > 1 %}
                    <p class="form-hint" style="color: var(--color-warning); margin-top: 0.5rem;">Hapus semua varian kecuali satu untuk menonaktifkan fitur varian.</p>
                    {% endif %}
                </div>
                
                <div id="non-variant-fields" style="display: {{ 'none' if product.has_variants else 'block' }};">
                    <div class="form-grid">
                        <div class="form-group" id="stock-input-container">
                            <label for="stock">Stok</label>
                            <input type="number" id="stock" name="stock" value="{{ product.stock }}">
                        </div>
                        <div class="form-group" id="weight-input-container-edit">
                            <label for="weight_grams">Berat (gram)</label>
                            <input type="number" id="weight_grams" name="weight_grams" value="{{ product.weight_grams or 150 }}">
                        </div>
                        <div class="form-group" id="sku-input-container">
                            <label for="sku">SKU</label>
                            <input type="text" id="sku" name="sku" value="{{ product.sku or '' }}">
                        </div>
                    </div>
                </div>
                
                <div class="form-hint" id="variant-conversion-hint" style="display:none; margin-top: 1rem; padding: 1rem; background-color: rgba(59, 130, 246, 0.1); border: 1px solid var(--color-primary); border-radius: var(--border-radius-sm);">
                    <strong>Anda akan mengubah produk ini menjadi produk bervarian.</strong>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem; font-size: 0.85rem;">
                        <li>Stok, berat, dan SKU saat ini akan diubah menjadi varian pertama dengan Warna "STANDAR" dan Ukuran "STANDAR".</li>
                        <li>Setelah menyimpan, Anda dapat mengedit varian ini dan menambah varian lainnya melalui tab "Varian Produk".</li>
                    </ul>
                </div>
                <div class="form-hint" id="non-variant-conversion-hint" style="display:none; margin-top: 1rem; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border: 1px solid var(--color-danger); border-radius: var(--border-radius-sm);">
                    <strong>Peringatan:</strong> Anda akan mengubah produk ini menjadi produk non-varian. <strong>Semua varian yang ada akan dihapus permanen.</strong> Pastikan untuk mengisi stok, berat, dan SKU di atas.
                </div>

                <div class="form-group" style="margin-top: 1.5rem;">
                    <label>Gambar Saat Ini</label>
                    <p class="form-hint">Klik gambar untuk menjadikannya gambar utama (ditandai bintang). Centang checkbox di pojok kiri atas untuk menandai gambar yang akan dihapus.</p>
                    <div id="existing-image-previews" class="image-preview-container">
                        {% if product.image_url %}
                        <div class="preview-item existing-preview is-main"
                             role="radio"
                             aria-checked="true"
                             tabindex="0"
                             aria-label="Pilih {{ product.image_url }} sebagai gambar utama">
                            <img src="{{ url_for('images.serve_image', filename=product.image_url) }}" alt="{{ product.name }}">
                            <div class="main-image-indicator"><i class="fas fa-star"></i> Utama</div>
                            <input type="radio" name="main_image" value="{{ product.image_url }}" class="main-image-radio" checked tabindex="-1">
                            <div class="delete-checkbox-overlay">
                                <label class="custom-checkbox" title="Tandai untuk hapus">
                                    <input type="checkbox" name="delete_image" value="{{ product.image_url }}" class="checkbox-input delete-image-checkbox">
                                    <span class="checkbox-box"><span class="checkmark"></span></span>
                                </label>
                            </div>
                        </div>
                        {% endif %}
                        {% for image in additional_images %}
                        <div class="preview-item existing-preview"
                             role="radio"
                             aria-checked="false"
                             tabindex="0"
                             aria-label="Pilih {{ image }} sebagai gambar utama">
                            <img src="{{ url_for('images.serve_image', filename=image) }}" alt="{{ product.name }} tambahan">
                            <div class="main-image-indicator"><i class="fas fa-star"></i> Utama</div>
                            <input type="radio" name="main_image" value="{{ image }}" class="main-image-radio" tabindex="-1">
                             <div class="delete-checkbox-overlay">
                                <label class="custom-checkbox" title="Tandai untuk hapus">
                                    <input type="checkbox" name="delete_image" value="{{ image }}" class="checkbox-input delete-image-checkbox">
                                    <span class="checkbox-box"><span class="checkmark"></span></span>
                                </label>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% if not product.image_url and not additional_images %}
                    <p class="form-hint" style="color: var(--color-warning);">Tidak ada gambar untuk produk ini.</p>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="new_images">Tambah Gambar Baru (Opsional)</label>
                    <div>
                        <label for="new_images" class="custom-file-upload">Pilih Gambar</label>
                        <input type="file" id="new_images" name="new_images" accept="image/*" multiple>
                         <span id="new-file-name" class="file-name-display">Belum ada file baru dipilih</span>
                    </div>
                    <div id="new-image-previews" class="image-preview-container"></div>
                </div>

                <div class="form-group"><label for="description">Deskripsi</label><textarea id="description" name="description" rows="4" required>{{ product.description }}</textarea></div>
                <div class="form-actions">
                    <button type="submit" class="cta-button">Simpan Perubahan</button>
                </div>
            </form>
        </div>
    </div>

    <div class="admin-tab-content" id="tab-variants">
        <div class="admin-card animated-element">
            {% include 'partials/admin/_variants_content.html' %}
        </div>
    </div>
</div>