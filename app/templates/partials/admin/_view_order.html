<div style="margin-bottom: 2rem;" class="animated-element">
    <a href="{{ url_for('admin.admin_orders') }}" class="cta-button-secondary" data-no-transition>&larr; Kembali ke Daftar Pesanan</a>
    <a href="{{ url_for('admin.admin_order_invoice', id=order.id) }}" target="_blank" class="cta-button" style="float: right;">Cetak Invoice</a>
</div>
<div class="order-detail-grid">
    <div class="admin-card animated-element" data-animation-delay="100">
        <h3>Informasi Pesanan</h3>
        <p><strong>ID Pesanan:</strong> #{{ order.id }}</p>
        <p><strong>Tanggal:</strong> {{ (order.order_date | datetime_from_string).strftime('%d %B %Y, %H:%M') }}</p>
        <p><strong>Pelanggan:</strong> {{ order.customer_name or 'Tamu' }} ({{ order.email or 'N/A' }})</p>
        <p><strong>Total Pembayaran:</strong> {{ order.total_amount|rupiah }}</p>
        <p><strong>Metode Pembayaran:</strong> {{ order.payment_method or 'N/A' }}</p>
        <p id="order-status-display"><strong>Status Saat Ini:</strong> <span class="status-badge status-{{ order.status|status_class }}">{{ order.status|status_translate }}</span></p>
    </div>
    <div class="admin-card animated-element" data-animation-delay="200">
        <h3>Update Pesanan</h3>
        <form id="update-order-form" action="{{ url_for('admin.update_order_status', id=order.id) }}" method="POST" data-ajax="true" data-update-action="update-status">
            <div class="form-group">
                <label for="status">Ubah Status</label>
                <select name="status" id="status" class="form-control">
                    <option value="Menunggu Pembayaran" {% if order.status == 'Menunggu Pembayaran' %}selected{% endif %}>Menunggu Pembayaran</option>
                    <option value="Diproses" {% if order.status == 'Diproses' %}selected{% endif %}>Diproses</option>
                    <option value="Dikirim" {% if order.status == 'Dikirim' %}selected{% endif %}>Dikirim</option>
                    <option value="Selesai" {% if order.status == 'Selesai' %}selected{% endif %}>Selesai</option>
                    <option value="Dibatalkan" {% if order.status == 'Dibatalkan' %}selected{% endif %}>Dibatalkan</option>
                </select>
            </div>
             <div class="form-group">
                <label for="tracking_number">Nomor Resi Pengiriman</label>
                <input type="text" name="tracking_number" id="tracking_number" class="form-control" value="{{ order.tracking_number or '' }}" placeholder="Masukkan nomor resi di sini">
            </div>
            <button type="submit" class="cta-button form-button">Update Pesanan</button>
        </form>
    </div>
</div>

<div class="admin-card animated-element" data-animation-delay="300">
    <h3>Informasi Pengiriman</h3>
    <p><strong>Nama Penerima:</strong> {{ order.shipping_name or 'N/A' }}</p>
    <p><strong>Telepon:</strong> {{ order.shipping_phone or 'N/A' }}</p>
    <p><strong>Alamat:</strong><br>
        {{ order.shipping_address_line_1 or '' }}<br>
        {% if order.shipping_address_line_2 %}{{ order.shipping_address_line_2 }}<br>{% endif %}
        {{ order.shipping_city or '' }}, {{ order.shipping_province or '' }} {{ order.shipping_postal_code or '' }}
    </p>
</div>

<div class="admin-card animated-element" data-animation-delay="400">
    <h3>Item yang Dipesan</h3>
    <div class="table-wrapper">
        <table class="admin-table">
            <thead><tr><th>Nama Produk</th><th>Jumlah</th><th>Harga Satuan</th><th>Subtotal</th></tr></thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        {{ item.name }}
                        {% if item.color_at_order or item.size_at_order %}
                            <span style="display: block; font-size: 0.9em; color: var(--color-text-secondary);">
                                ({{ [item.color_at_order, item.size_at_order]|select('!=', None)|join(' / ') }})
                            </span>
                        {% endif %}
                    </td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.price|rupiah }}</td>
                    <td>{{ (item.price * item.quantity)|rupiah }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>