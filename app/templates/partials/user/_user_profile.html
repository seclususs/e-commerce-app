<section class="user-profile-section">
    <div class="profile-container animated-element">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
            <h2 class="section-title" style="margin: 0;">Profil Saya</h2>
            <a href="{{ url_for('user.edit_profile') }}" class="cta-button-secondary" data-ajax-nav="true">Edit Profil</a>
        </div>

        <div class="admin-card animated-element" data-animation-delay="200">
            <div class="order-detail-grid">
                <div>
                    <h3>Informasi Akun</h3>
                    <p><strong>Username:</strong> {{ user.username }}</p>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                </div>
                <div>
                    <h3>Alamat Utama</h3>
                    {% if user.address_line_1 %}
                        <p><strong>Telepon:</strong> {{ user.phone }}</p>
                        <p>{{ user.address_line_1 }}<br>
                           {% if user.address_line_2 %}{{ user.address_line_2 }}<br>{% endif %}
                           {{ user.city }}, {{ user.province }} {{ user.postal_code }}
                        </p>
                    {% else %}
                        <p style="color: #94a3b8;">Anda belum mengatur alamat utama.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="admin-card animated-element" data-animation-delay="400">
            <h3>Riwayat Pesanan</h3>
            <div class="table-wrapper">
                <table class="admin-table user-profile-orders">
                    <thead><tr><th>ID Pesanan</th><th>Tanggal</th><th>Total</th><th>Status</th><th>No. Resi</th><th>Aksi</th></tr></thead>
                    <tbody id="orders-list">
                        {% for order in orders %}
                        <tr id="order-row-{{ order.id }}">
                            <td data-label="ID Pesanan:">#{{ order.id }}</td>
                            <td data-label="Tanggal:">{{ order.order_date.strftime('%Y-%m-%d') }}</td>
                            <td data-label="Total:">{{ order.total_amount|rupiah }}</td>
                            <td data-label="Status:"><span class="status-badge status-{{ order.status|status_class }}">{{ order.status|status_translate }}</span></td>
                            <td data-label="No. Resi:">{{ order.tracking_number or '-' }}</td>
                            <td data-label="Aksi:" class="profile-order-actions">
                                <div class="action-buttons-container">
                                    <a href="{{ url_for('user.track_order', order_id=order.id) }}" class="cta-button-secondary action-btn" data-ajax-nav="true">Lacak</a>
                                    {% if order.status in ['Menunggu Pembayaran', 'Diproses'] %}
                                        <button class="btn-cancel ajax-cancel-order action-btn"
                                                data-order-id="{{ order.id }}"
                                                data-url="{{ url_for('purchase.cancel_order', order_id=order.id) }}">
                                            Batalkan
                                        </button>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="6" style="text-align: center;">Anda belum memiliki riwayat pesanan.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <a href="{{ url_for('product.products_page') }}" class="cta-button-secondary" style="display:inline-block; margin-top: 2rem;" data-ajax-nav="true">Lanjutkan Belanja</a>
    </div>
</section>