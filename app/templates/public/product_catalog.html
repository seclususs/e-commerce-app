{% extends "layouts/base_layout.html" %}

{% block title %}Koleksi Produk - {{ content.app_name }}{% endblock %}

{% block content %}
<section class="products-page-section">
    <button class="cta-button filter-toggle-btn" id="filterToggleButton">
        <i class="fas fa-filter"></i> Filter & Urutkan
    </button>

    <div class="filter-off-canvas" id="filterOffCanvas">
        <div class="filter-off-canvas-header">
            <h3>Filter & Urutkan</h3>
            <button id="closeFilterBtn" class="close-cart">&times;</button>
        </div>
        <div class="filter-off-canvas-body">
            <div class="filter-off-canvas-content">
                <form method="GET" action="{{ url_for('product.products_page') }}" id="filter-form-mobile">
                    <div class="search-bar">
                        <input type="search" name="search" placeholder="Cari produk..." value="{{ request.args.get('search', '') }}" class="form-control">
                    </div>
                     <div class="filter-group">
                        <label>Urutkan:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label"><input type="radio" name="sort" value="popularity" {% if not request.args.get('sort') or request.args.get('sort') == 'popularity' %}checked{% endif %}> Popularitas</label>
                            <label class="checkbox-label"><input type="radio" name="sort" value="price_asc" {% if request.args.get('sort') == 'price_asc' %}checked{% endif %}> Harga Terendah</label>
                            <label class="checkbox-label"><input type="radio" name="sort" value="price_desc" {% if request.args.get('sort') == 'price_desc' %}checked{% endif %}> Harga Tertinggi</label>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Kategori:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label"><input type="radio" name="category" value="" {% if not request.args.get('category') %}checked{% endif %}> Semua</label>
                            {% for cat in categories %}<label class="checkbox-label"><input type="radio" name="category" value="{{ cat.id }}" {% if request.args.get('category')|int == cat.id %}checked{% endif %}> {{ cat.name }}</label>{% endfor %}
                        </div>
                    </div>
                     <div class="filter-actions">
                        <button type="submit" class="cta-button">Terapkan</button>
                        <a href="{{ url_for('product.products_page') }}" class="cta-button-secondary">Reset</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="filter-overlay" id="filterOverlay"></div>

    <div class="filters-bar admin-card animated-element">
        <form method="GET" action="{{ url_for('product.products_page') }}" id="filter-form-desktop">
            <div class="search-bar">
                <input type="search" name="search" placeholder="Cari produk..." value="{{ request.args.get('search', '') }}" class="form-control">
                <button type="submit" class="cta-button">Cari</button>
            </div>
            <div class="filter-group">
                <label>Urutkan:</label>
                <div class="checkbox-group">
                    <label class="checkbox-label"><input type="radio" name="sort" value="popularity" {% if not request.args.get('sort') or request.args.get('sort') == 'popularity' %}checked{% endif %}> Popularitas</label>
                    <label class="checkbox-label"><input type="radio" name="sort" value="price_asc" {% if request.args.get('sort') == 'price_asc' %}checked{% endif %}> Harga Terendah</label>
                    <label class="checkbox-label"><input type="radio" name="sort" value="price_desc" {% if request.args.get('sort') == 'price_desc' %}checked{% endif %}> Harga Tertinggi</label>
                </div>
            </div>
            <div class="filter-group">
                <label>Kategori:</label>
                <div class="checkbox-group">
                    <label class="checkbox-label"><input type="radio" name="category" value="" {% if not request.args.get('category') %}checked{% endif %}> Semua</label>
                    {% for cat in categories %}<label class="checkbox-label"><input type="radio" name="category" value="{{ cat.id }}" {% if request.args.get('category')|int == cat.id %}checked{% endif %}> {{ cat.name }}</label>{% endfor %}
                </div>
            </div>
            <a href="{{ url_for('product.products_page') }}" class="cta-button-secondary reset-filter-btn">Reset</a>
        </form>
    </div>

    <main class="products-main-grid">
        <div class="products-grid" id="product-grid-container">
            {% if products %}
                {% include 'partials/_product_card.html' %}
            {% else %}
                <p class="no-products-found animated-element">Tidak ada produk yang cocok dengan pencarian atau filter Anda.</p>
            {% endif %}
        </div>
    </main>
</section>
{% endblock %}