{% extends "layouts/base_layout.html" %}

{% block title %}Lacak Pesanan #{{ order.id }} - {{ content.app_name }}{% endblock %}

{% block content %}
<section class="order-tracking-section">
    <div class="tracking-container animated-element">
        <div class="tracking-header admin-card">
            <h2 class="section-title" style="margin-bottom: 1.5rem;">Pelacakan Pesanan #{{ order.id }}</h2>
            <div class="order-info-grid">
                <div>
                    <p><strong>Nomor Pesanan:</strong></p>
                    <p>#{{ order.id }}</p>
                </div>
                <div>
                    <p><strong>Tanggal Pesanan:</strong></p>
                    <p>{{ (order.order_date | datetime_from_string).strftime('%d %B %Y, %H:%M') }}</p>
                </div>
                <div>
                    <p><strong>Status Saat Ini:</strong></p>
                    <p><span class="status-badge status-{{ order.status | status_class }}">{{ order.status | status_translate }}</span></p>
                </div>
                <div>
                    <p><strong>Estimasi Tiba:</strong></p>
                    <p class="eta">{{ (order.order_date | add_days(3)).strftime('%d %B %Y') }}</p> <!-- Asumsi estimasi 3 hari -->
                </div>
            </div>
             {% if order.tracking_number %}
                <div class="tracking-number-info">
                    <p><strong>Nomor Resi:</strong></p>
                    <p>{{ order.tracking_number }}</p>
                </div>
            {% endif %}
        </div>

        <div class="tracking-timeline-container admin-card animated-element" data-animation-delay="100">
            <h3>Riwayat Status Pesanan</h3>
            <div class="timeline">
                {% for event in history_list %}
                <div class="timeline-item {% if loop.first %}current{% endif %}">
                    <div class="timeline-marker">
                        <div class="timeline-dot"></div>
                    </div>
                    <div class="timeline-content">
                        <span class="timeline-status">{{ event.status | status_translate }}</span>
                        <span class="timeline-timestamp">{{ (event.timestamp | datetime_from_string).strftime('%d %b %Y, %H:%M') }}</span>
                        {% if event.notes %}
                        <p class="timeline-notes">{{ event.notes }}</p>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <p>Riwayat pesanan tidak tersedia.</p>
                {% endfor %}
            </div>
        </div>

        <div class="admin-card order-summary-card animated-element" data-animation-delay="200">
            <h3>Ringkasan Pesanan</h3>
            <ul class="order-item-list">
                {% for item in items %}
                <li class="order-item">
                    <div class="item-details">
                        <span class="item-name">{{ item.name }} {% if item.size_at_order %}({{ item.size_at_order }}){% endif %}</span>
                    </div>
                    <div class="item-price-qty">
                        <span class="item-quantity">x {{ item.quantity }}</span>
                        <span class="item-price">{{ (item.price * item.quantity) | rupiah }}</span>
                    </div>
                </li>
                {% else %}
                <li>Item pesanan tidak ditemukan.</li>
                {% endfor %}
            </ul>
            <div class="order-total-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>{{ order.subtotal | rupiah }}</span>
                </div>
                {% if order.discount_amount > 0 %}
                <div class="summary-row discount-row">
                    <span>Diskon{% if order.voucher_code %} ({{ order.voucher_code }}){% endif %}</span>
                    <span>- {{ order.discount_amount | rupiah }}</span>
                </div>
                {% endif %}
                {% if order.shipping_cost > 0 %}
                <div class="summary-row">
                    <span>Biaya Pengiriman</span>
                    <span>{{ order.shipping_cost | rupiah }}</span>
                </div>
                 {% else %}
                 <div class="summary-row">
                    <span>Biaya Pengiriman</span>
                    <span>Gratis</span>
                </div>
                {% endif %}
                <div class="summary-row total">
                    <span>Total</span>
                    <span>{{ order.total_amount | rupiah }}</span>
                </div>
            </div>
        </div>

        <div class="tracking-actions animated-element" data-animation-delay="300">
            <a href="{{ url_for('user.user_profile') }}" class="cta-button-secondary">Kembali ke Profil</a>
            <a href="{{ url_for('product.products_page') }}" class="cta-button">Lanjut Belanja</a>
        </div>
    </div>
</section>
{% endblock %}